{"ast":null,"code":"import { Compra } from 'src/app/Modelo/Compra';\nimport { ProdcutosCompra } from 'src/app/Modelo/ProductosCompra';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/Service/compras.service\";\nimport * as i2 from \"src/app/Service/productos.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction ComprasComponent_div_0_option_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 25);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const pr_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", pr_r5.codigo);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate3(\"C.\", pr_r5.codigo, \": \", pr_r5.nombre, \", en bodega (\", pr_r5.cantidad_bodega, \")\");\n  }\n}\nfunction ComprasComponent_div_0_tr_50_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const pc_r7 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(pc_r7.id_compra);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(pc_r7.producto);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(pc_r7.cantidad);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(pc_r7.precio_unitario);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(pc_r7.subtotal);\n  }\n}\nfunction ComprasComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"div\", 3)(2, \"div\", 4)(3, \"div\", 5)(4, \"nav\", 6)(5, \"h3\", 7);\n    i0.ɵɵtext(6, \"Nueva Compra\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 8)(8, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function ComprasComponent_div_0_Template_button_click_8_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.dejarDeMostrarNuevaCompra());\n    });\n    i0.ɵɵelement(9, \"i\", 10);\n    i0.ɵɵtext(10, \" Aceptar\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"div\", 11)(12, \"form\", 12, 13);\n    i0.ɵɵlistener(\"ngSubmit\", function ComprasComponent_div_0_Template_form_ngSubmit_12_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const _r2 = i0.ɵɵreference(13);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.agregarProductoACompra(_r2));\n    });\n    i0.ɵɵelementStart(14, \"div\", 14)(15, \"label\", 15);\n    i0.ɵɵtext(16, \"Seleccione el producto:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"select\", 16);\n    i0.ɵɵlistener(\"ngModelChange\", function ComprasComponent_div_0_Template_select_ngModelChange_17_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.productoSeleccionado = $event);\n    });\n    i0.ɵɵtemplate(18, ComprasComponent_div_0_option_18_Template, 2, 4, \"option\", 17);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(19, \"br\");\n    i0.ɵɵelementStart(20, \"div\", 14)(21, \"label\", 18);\n    i0.ɵɵtext(22, \"Ingrese la cantidad del producto:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"input\", 19);\n    i0.ɵɵlistener(\"ngModelChange\", function ComprasComponent_div_0_Template_input_ngModelChange_23_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.cantidadProducto = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(24, \"br\");\n    i0.ɵɵelementStart(25, \"div\", 14)(26, \"label\", 20);\n    i0.ɵɵtext(27, \"Ingrese el precio de compra del producto:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(28, \"input\", 21);\n    i0.ɵɵlistener(\"ngModelChange\", function ComprasComponent_div_0_Template_input_ngModelChange_28_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.precioProducto = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(29, \"br\");\n    i0.ɵɵelementStart(30, \"div\")(31, \"button\", 22);\n    i0.ɵɵelement(32, \"i\", 10);\n    i0.ɵɵtext(33, \" Agregar\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(34, \"h3\");\n    i0.ɵɵtext(35);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(36, \"table\", 23)(37, \"thead\")(38, \"tr\")(39, \"th\");\n    i0.ɵɵtext(40, \"Compra\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(41, \"th\");\n    i0.ɵɵtext(42, \"Nombre producto\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(43, \"th\");\n    i0.ɵɵtext(44, \"Cantidad\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(45, \"th\");\n    i0.ɵɵtext(46, \"Precio unitario\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(47, \"th\");\n    i0.ɵɵtext(48, \"Subtotal\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(49, \"tbody\");\n    i0.ɵɵtemplate(50, ComprasComponent_div_0_tr_50_Template, 11, 5, \"tr\", 24);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(51, \"h3\");\n    i0.ɵɵtext(52);\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const _r2 = i0.ɵɵreference(13);\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(17);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.productoSeleccionado);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.productos);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.cantidadProducto);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.precioProducto);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"disabled\", !_r2.form.valid);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"Productos en la compra \", ctx_r0.codigoNuevaCompra, \"\");\n    i0.ɵɵadvance(15);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.productosNuevaCompra);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Precio total \", ctx_r0.totalNuevaCompra, \"\");\n  }\n}\nfunction ComprasComponent_div_1_tr_23_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\", 31)(10, \"button\", 32);\n    i0.ɵɵlistener(\"click\", function ComprasComponent_div_1_tr_23_Template_button_click_10_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r19);\n      const compra_r16 = restoredCtx.$implicit;\n      const ctx_r18 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r18.verDetalles(compra_r16));\n    });\n    i0.ɵɵelement(11, \"i\", 33);\n    i0.ɵɵtext(12, \" Detalles\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const compra_r16 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(compra_r16.codigo);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(compra_r16.sucursal);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(compra_r16.fecha);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(compra_r16.total_compra);\n  }\n}\nfunction ComprasComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r21 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 26)(1, \"div\", 27)(2, \"h3\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 28)(5, \"button\", 29);\n    i0.ɵɵlistener(\"click\", function ComprasComponent_div_1_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r20 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r20.nuevaCompra());\n    });\n    i0.ɵɵelement(6, \"i\", 30);\n    i0.ɵɵtext(7, \" Agregar \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(8, \"br\");\n    i0.ɵɵelementStart(9, \"table\", 23)(10, \"thead\")(11, \"tr\")(12, \"th\");\n    i0.ɵɵtext(13, \"Codigo\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"th\");\n    i0.ɵɵtext(15, \"Sucursal\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"th\");\n    i0.ɵɵtext(17, \"Fecha de compra\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"th\");\n    i0.ɵɵtext(19, \"Total\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"th\", 31);\n    i0.ɵɵtext(21, \"ACCIONES\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(22, \"tbody\");\n    i0.ɵɵtemplate(23, ComprasComponent_div_1_tr_23_Template, 13, 4, \"tr\", 24);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Totales (\", ctx_r1.compras.length, \") \");\n    i0.ɵɵadvance(20);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.compras);\n  }\n}\nexport class ComprasComponent {\n  constructor(servicioCompras, servicioProductos) {\n    this.servicioCompras = servicioCompras;\n    this.servicioProductos = servicioProductos;\n    this.mostrarNuevaCompra = false;\n    this.totalNuevaCompra = 0;\n  }\n  ngOnInit() {\n    this.servicioCompras.getCompras(this.getRolDB()).subscribe(data => {\n      this.compras = data;\n      this.traerProductos();\n    }, error => {\n      console.log(error);\n      this.traerProductos();\n    });\n  }\n  verDetalles(compra) {}\n  filtrarCompras(filtro) {\n    console.log(\"filtro: \" + filtro);\n  }\n  getRolDB() {\n    let stringUser = localStorage.getItem('usuario');\n    let usuario = stringUser ? JSON.parse(stringUser) : null;\n    let rol = usuario ? usuario.rol : 0;\n    return rol;\n  }\n  getIDUser() {\n    let stringUser = localStorage.getItem('usuario');\n    let usuario = stringUser ? JSON.parse(stringUser) : null;\n    let rol = usuario ? usuario.identificacion : 0;\n    return rol;\n  }\n  getSucursal() {\n    let stringUser = localStorage.getItem('usuario');\n    let usuario = stringUser ? JSON.parse(stringUser) : null;\n    let suc = usuario ? usuario.sucursal : 0;\n    return suc;\n  }\n  nuevaCompra() {\n    //hacer que se agregue una nueva compra\n    this.productosNuevaCompra = [];\n    this.totalNuevaCompra = 0;\n    this.mostrarNuevaCompra = true;\n    let compra = new Compra();\n    compra.usuario = this.getIDUser();\n    compra.sucursal = this.getSucursal();\n    this.servicioCompras.nuevaCompra(compra, this.getRolDB()).subscribe(data => {\n      this.codigoNuevaCompra = data.codigo_compra;\n      console.log(this.codigoNuevaCompra);\n    }, error => {\n      console.log(error);\n    });\n  }\n  traerProductosNuevaCompra(idC) {\n    this.servicioProductos.getProductosNuevaCompra(idC, this.getRolDB()).subscribe(data => {\n      this.productosNuevaCompra = data;\n    }, error => {\n      console.log(error);\n    });\n  }\n  agregarProductoACompra(nuevaCompraForm) {\n    let pc = new ProdcutosCompra(this.codigoNuevaCompra, parseInt(this.productoSeleccionado), this.cantidadProducto, this.precioProducto);\n    this.servicioProductos.nuevoProductoCompra(pc, this.getRolDB()).subscribe(data => {\n      console.log(data);\n      this.traerProductosNuevaCompra(this.codigoNuevaCompra);\n      nuevaCompraForm.resetForm();\n      this.totalNuevaCompra += pc.cantidad * pc.precio_unitario;\n    }, error => {\n      console.log(error);\n    });\n  }\n  traerProductos() {\n    this.servicioProductos.getProductosSucursal(this.getSucursal(), this.getRolDB()).subscribe(data => {\n      this.productos = data;\n    }, error => {\n      console.log(error);\n    });\n  }\n  dejarDeMostrarNuevaCompra() {\n    this.mostrarNuevaCompra = false;\n    if (this.totalNuevaCompra == 0) {\n      //eliminar la compra\n      this.servicioCompras.deleteCompra(this.getRolDB(), this.codigoNuevaCompra).subscribe(data => {\n        console.log(\"compra eliminada\");\n        this.ngOnInit();\n      });\n    } else {\n      this.ngOnInit();\n    }\n  }\n  static #_ = this.ɵfac = function ComprasComponent_Factory(t) {\n    return new (t || ComprasComponent)(i0.ɵɵdirectiveInject(i1.ComprasService), i0.ɵɵdirectiveInject(i2.ProductosService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ComprasComponent,\n    selectors: [[\"app-compras\"]],\n    decls: 2,\n    vars: 2,\n    consts: [[\"class\", \"container mt-2 col-md-10\", 4, \"ngIf\"], [\"class\", \"container mt-5 pt-5\", 4, \"ngIf\"], [1, \"container\", \"mt-2\", \"col-md-10\"], [1, \"row\"], [1, \"col\"], [1, \"card\", \"my-10\"], [1, \"navbar\", \"navbar-expand-lg\", \"bg-white\", \"navbar-light\", \"py-3\", \"py-lg-0\", \"px-lg-5\"], [1, \"mt-2\", \"me-4\"], [1, \"text-end\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"bi\", \"bi-add\"], [1, \"card-body\"], [3, \"ngSubmit\"], [\"nuevaCompraForm\", \"ngForm\"], [1, \"form-group\"], [\"for\", \"rol\"], [\"aria-label\", \"Default select example\", \"id\", \"combo\", \"name\", \"comoboProductos\", \"required\", \"\", 1, \"form-select\", 3, \"ngModel\", \"ngModelChange\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"for\", \"cantidad\"], [\"type\", \"number\", \"name\", \"cantidad\", \"required\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"for\", \"precio\"], [\"type\", \"number\", \"name\", \"precio\", \"required\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"submit\", 1, \"btn\", \"btn-success\", 3, \"disabled\"], [1, \"table\", \"table-bordered\"], [4, \"ngFor\", \"ngForOf\"], [3, \"value\"], [1, \"container\", \"mt-5\", \"pt-5\"], [1, \"card\"], [1, \"text-end\", \"container\", \"pt-5\"], [\"aria-label\", \"Agregar compra\", 1, \"btn\", \"btn-primary\", \"ms-3\", 3, \"click\"], [1, \"bi\", \"bi-cart-plus-fill\", \"bi-xxl\"], [1, \"text-center\"], [1, \"btn\", \"btn-warning\", \"me-2\", \"col-sm-5\", 3, \"click\"], [1, \"bi\", \"bi-eye\"]],\n    template: function ComprasComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, ComprasComponent_div_0_Template, 53, 8, \"div\", 0);\n        i0.ɵɵtemplate(1, ComprasComponent_div_1_Template, 24, 2, \"div\", 1);\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.mostrarNuevaCompra);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.mostrarNuevaCompra);\n      }\n    },\n    dependencies: [i3.NgForOf, i3.NgIf, i4.ɵNgNoValidate, i4.NgSelectOption, i4.ɵNgSelectMultipleOption, i4.DefaultValueAccessor, i4.NumberValueAccessor, i4.SelectControlValueAccessor, i4.NgControlStatus, i4.NgControlStatusGroup, i4.RequiredValidator, i4.NgModel, i4.NgForm],\n    styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n  });\n}","map":{"version":3,"mappings":"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","names":["Compra","ProdcutosCompra","i0","ComprasComponent","constructor","servicioCompras","servicioProductos","ngOnInit","getCompras","getRolDB","subscribe","data","compras","traerProductos","error","console","log","verDetalles","compra","filtrarCompras","filtro","stringUser","localStorage","getItem","usuario","JSON","parse","rol","getIDUser","identificacion","getSucursal","suc","sucursal","nuevaCompra","productosNuevaCompra","totalNuevaCompra","mostrarNuevaCompra","codigoNuevaCompra","codigo_compra","traerProductosNuevaCompra","idC","getProductosNuevaCompra","agregarProductoACompra","nuevaCompraForm","pc","parseInt","productoSeleccionado","cantidadProducto","precioProducto","nuevoProductoCompra","resetForm","cantidad","precio_unitario","getProductosSucursal","productos","dejarDeMostrarNuevaCompra","deleteCompra","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["/home/eiler/Documentos/Universidad/SegundoSemestre2024/Archivos/Proyecto1/app/FRONTEND/src/app/area-bodega/compras/compras.component.ts","/home/eiler/Documentos/Universidad/SegundoSemestre2024/Archivos/Proyecto1/app/FRONTEND/src/app/area-bodega/compras/compras.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { Compra } from 'src/app/Modelo/Compra';\nimport { ComprasService } from 'src/app/Service/compras.service';\nimport { Usuario } from 'src/app/Modelo/Usuario';\nimport { data, error } from 'jquery';\nimport { Producto } from 'src/app/Modelo/Producto';\nimport { ProductosService } from 'src/app/Service/productos.service';\nimport { ProdcutosCompra } from 'src/app/Modelo/ProductosCompra';\nimport { NgForm } from '@angular/forms';\n@Component({\n  selector: 'app-compras',\n  templateUrl: './compras.component.html',\n  styleUrls: ['./compras.component.css']\n})\nexport class ComprasComponent {\n  constructor(private servicioCompras:ComprasService, private servicioProductos:ProductosService){}\n  compras!:Compra[]\n  mostrarNuevaCompra:boolean=false;\n  productos!:Producto[]\n\n  precioProducto!:number\n  cantidadProducto!:number\n  productoSeleccionado!:any\n\n  codigoNuevaCompra!:number\n\n  productosNuevaCompra !:ProdcutosCompra[]\n\n  totalNuevaCompra:number=0;\n\n  ngOnInit():void{\n    this.servicioCompras.getCompras(this.getRolDB()).subscribe(data=>{\n      this.compras=data;\n      this.traerProductos();\n    }, error=>{\n      console.log(error)\n      this.traerProductos();\n    })\n  }\n  verDetalles(compra:Compra){\n\n  }\n\n  filtrarCompras(filtro:string){\n    console.log(\"filtro: \" + filtro)\n  }\n\n  getRolDB(){\n    let stringUser = localStorage.getItem('usuario');\n    let usuario:Usuario = stringUser? JSON.parse(stringUser):null;\n    let rol = usuario? usuario.rol:0;\n    return rol;\n  }\n  getIDUser(){\n    let stringUser = localStorage.getItem('usuario');\n    let usuario:Usuario = stringUser? JSON.parse(stringUser):null;\n    let rol = usuario? usuario.identificacion:0;\n    return rol;\n  }\n  getSucursal(){\n    let stringUser = localStorage.getItem('usuario');\n    let usuario:Usuario = stringUser? JSON.parse(stringUser):null;\n    let suc = usuario? usuario.sucursal:0;\n    return suc;\n  }\n\n  nuevaCompra(){\n    //hacer que se agregue una nueva compra\n    this.productosNuevaCompra= []\n    this.totalNuevaCompra=0;\n    this.mostrarNuevaCompra=true;\n    let compra = new Compra();\n    compra.usuario=this.getIDUser();\n    compra.sucursal=this.getSucursal();\n    this.servicioCompras.nuevaCompra(compra,this.getRolDB()).subscribe(data=>{\n      this.codigoNuevaCompra=data.codigo_compra;\n      console.log(this.codigoNuevaCompra)\n      \n    },error=>{\n      console.log(error)\n    })\n  }\n\n  traerProductosNuevaCompra(idC:number){\n    this.servicioProductos.getProductosNuevaCompra(idC,this.getRolDB()).subscribe(data=>{\n      this.productosNuevaCompra=data;\n    },error=>{\n      console.log(error)\n    })\n  }\n\n  agregarProductoACompra(nuevaCompraForm:NgForm) {\n    let pc = new ProdcutosCompra(this.codigoNuevaCompra,parseInt(this.productoSeleccionado),this.cantidadProducto,this.precioProducto);\n    this.servicioProductos.nuevoProductoCompra(pc,this.getRolDB()).subscribe(data=>{\n      console.log(data);\n      this.traerProductosNuevaCompra(this.codigoNuevaCompra);\n      nuevaCompraForm.resetForm();\n      this.totalNuevaCompra+=pc.cantidad*pc.precio_unitario;\n    }, error=>{\n      console.log(error)\n    })\n  }\n\n  traerProductos(){\n    this.servicioProductos.getProductosSucursal(this.getSucursal(),this.getRolDB()).subscribe(data=>{\n      this.productos=data;\n    }, error=>{\n      console.log(error)\n    })\n  }\n\n  dejarDeMostrarNuevaCompra(){\n    this.mostrarNuevaCompra=false;\n    if(this.totalNuevaCompra==0){\n      //eliminar la compra\n      this.servicioCompras.deleteCompra(this.getRolDB(),this.codigoNuevaCompra).subscribe(data=>{\n        console.log(\"compra eliminada\");\n        this.ngOnInit();\n      })\n    }else{\n      this.ngOnInit();\n    }\n  }\n  \n\n\n\n}\n","\n\n<div class=\"container mt-2 col-md-10\" *ngIf=\"mostrarNuevaCompra\">\n    <div class=\"row\">\n        <div class=\"col\">\n            <div class=\"card my-10\">\n                <nav class=\"navbar navbar-expand-lg bg-white navbar-light py-3 py-lg-0 px-lg-5\">\n                    <h3 class=\"mt-2 me-4\">Nueva Compra</h3>\n                </nav>\n                <div class=\"text-end\">\n                    <button type=\"submit\" class=\"btn btn-primary\"\n                        (click)=\"dejarDeMostrarNuevaCompra()\"><i class=\"bi bi-add\"></i> Aceptar</button>\n                </div> \n                <div class=\"card-body\">\n                    <form (ngSubmit)=\"agregarProductoACompra(nuevaCompraForm)\"  #nuevaCompraForm=\"ngForm\">\n                        \n                        <div class=\"form-group\">\n                            <label for=\"rol\">Seleccione el producto:</label>\n                            <select class=\"form-select\" aria-label=\"Default select example\" id=\"combo\"  name=\"comoboProductos\" required [(ngModel)]=\"productoSeleccionado\">\n                                <option *ngFor=\"let pr of productos; let i = index\" [value]=\"pr.codigo\">C.{{pr.codigo}}:  {{pr.nombre}}, en bodega ({{pr.cantidad_bodega}})</option>\n                            </select>\n                        </div>\n                        <br>\n                        <div class=\"form-group\">\n                            <label for=\"cantidad\">Ingrese la cantidad del producto:</label>\n                            <input type=\"number\" class=\"form-control\" name=\"cantidad\" [(ngModel)]=\"cantidadProducto\"  required>\n                        </div>                        \n                        <br>\n                        <div class=\"form-group\">\n                            <label for=\"precio\">Ingrese el precio de compra del producto:</label>\n                            <input type=\"number\" class=\"form-control\" name=\"precio\" [(ngModel)]=\"precioProducto\"  required>\n                        </div>                        \n                        <br>\n                        <div>\n                            <button type=\"submit\" class=\"btn btn-success\"\n                                [disabled]=\"!nuevaCompraForm.form.valid\"><i class=\"bi bi-add\"></i> Agregar</button>\n                        </div> \n                    </form>\n                </div>\n                <h3>Productos en la compra {{codigoNuevaCompra}}</h3>\n                <table class=\"table table-bordered\">\n                    <thead>\n                        <tr>\n                            <th>Compra</th>\n                            <th>Nombre producto</th>\n                            <th>Cantidad</th>\n                            <th>Precio unitario</th>\n                            <th>Subtotal</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr *ngFor=\"let pc of productosNuevaCompra; let i = index\">\n                            <td>{{pc.id_compra}}</td>\n                            <td>{{pc.producto}}</td>\n                            <td>{{pc.cantidad}}</td>\n                            <td>{{pc.precio_unitario}}</td>\n                            <td>{{pc.subtotal}}</td>\n                        </tr>\n                        \n                    </tbody>\n                </table>\n                <h3>Precio total {{totalNuevaCompra}}</h3>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div class=\"container mt-5 pt-5\" *ngIf=\"!mostrarNuevaCompra\">\n    <div class=\"card\">\n        <h3>Totales ({{compras.length}}) </h3>\n        <div class=\"text-end container pt-5\">\n            \n            <button class=\"btn btn-primary ms-3\" aria-label=\"Agregar compra\" (click)=\"nuevaCompra()\">\n                <i class=\"bi bi-cart-plus-fill bi-xxl\"></i> Agregar\n            </button>\n            \n        </div><br>\n        \n        <table class=\"table table-bordered\">\n            <thead>\n                <tr>\n                    <th>Codigo</th>\n                    <th>Sucursal</th>\n                    <th>Fecha de compra</th>\n                    <th>Total</th>\n                    <th class=\"text-center\">ACCIONES</th>\n                </tr>\n            </thead>\n            <tbody>\n                <tr *ngFor=\"let compra of compras; let i = index\">\n                    <td>{{compra.codigo}}</td>\n                    <td>{{compra.sucursal}}</td>\n                    <td>{{compra.fecha}}</td>\n                    <td>{{compra.total_compra}}</td>\n                    <td class=\"text-center\">\n                        <button class=\"btn btn-warning me-2 col-sm-5\" (click)=\"verDetalles(compra)\"> <i class=\"bi bi-eye\"></i>      Detalles</button>\n                    </td>\n                </tr>\n            </tbody>\n        </table>\n    </div>\n</div>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}